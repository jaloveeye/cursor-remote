{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://cursor-remote.local/schemas/command-event.schema.json",
  "title": "command_event",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "event_id",
    "session_id",
    "timestamp",
    "tool",
    "command",
    "risk",
    "policy",
    "approval",
    "result"
  ],
  "properties": {
    "event_id": {
      "type": "string",
      "minLength": 1
    },
    "session_id": {
      "type": "string",
      "minLength": 1
    },
    "timestamp": {
      "type": "integer",
      "minimum": 0,
      "description": "Unix epoch in milliseconds"
    },
    "tool": {
      "type": "object",
      "additionalProperties": false,
      "required": ["provider", "name"],
      "properties": {
        "provider": {
          "type": "string",
          "enum": ["cursor", "codex", "other"]
        },
        "name": {
          "type": "string",
          "minLength": 1
        }
      }
    },
    "command": {
      "type": "object",
      "additionalProperties": false,
      "required": ["raw"],
      "properties": {
        "raw": {
          "type": "string",
          "minLength": 1
        },
        "cwd": {
          "type": "string"
        }
      }
    },
    "risk": {
      "type": "object",
      "additionalProperties": false,
      "required": ["level", "reasons"],
      "properties": {
        "level": {
          "type": "string",
          "enum": ["low", "medium", "high", "critical"]
        },
        "reasons": {
          "type": "array",
          "items": {
            "type": "string",
            "minLength": 1
          }
        }
      }
    },
    "policy": {
      "type": "object",
      "additionalProperties": false,
      "required": ["decision"],
      "properties": {
        "decision": {
          "type": "string",
          "enum": ["allow", "approval_required", "deny"]
        },
        "rule_id": {
          "type": "string"
        }
      }
    },
    "approval": {
      "type": "object",
      "additionalProperties": false,
      "required": ["required", "status"],
      "properties": {
        "required": {
          "type": "boolean"
        },
        "status": {
          "type": "string",
          "enum": ["not_required", "pending", "approved", "rejected"]
        },
        "approved_by": {
          "type": ["string", "null"]
        },
        "approved_at": {
          "type": ["integer", "null"],
          "minimum": 0
        },
        "reason": {
          "type": ["string", "null"]
        }
      }
    },
    "result": {
      "type": "object",
      "additionalProperties": false,
      "required": ["status"],
      "properties": {
        "status": {
          "type": "string",
          "enum": ["pending", "running", "success", "error", "cancelled", "timeout"]
        },
        "exit_code": {
          "type": ["integer", "null"]
        },
        "duration_ms": {
          "type": "integer",
          "minimum": 0
        },
        "error_message": {
          "type": ["string", "null"]
        }
      }
    },
    "metadata": {
      "type": "object",
      "additionalProperties": true
    }
  }
}
